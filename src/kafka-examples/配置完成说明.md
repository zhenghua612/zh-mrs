# Kafka Docker é›†ç¾¤é…ç½®å®Œæˆ âœ…

## ğŸ“‹ é…ç½®æ‘˜è¦

### Dockerç¯å¢ƒä¿¡æ¯
- **å®¹å™¨åç§°**: `kafka`
- **é•œåƒ**: `wurstmeister/kafka:2.12-2.5.0`
- **ç½‘ç»œ**: `hadoop-cluster_hadoop_network`
- **ç«¯å£æ˜ å°„**: `0.0.0.0:9092->9092/tcp`
- **è¿æ¥åœ°å€**: `localhost:9092`

### é…ç½®æ–‡ä»¶çŠ¶æ€
æ‰€æœ‰é…ç½®æ–‡ä»¶å·²åˆ›å»ºå¹¶é…ç½®å®Œæˆï¼Œä½äº `src/main/resources/` ç›®å½•ï¼š

| æ–‡ä»¶å | ç”¨é€” | bootstrap.servers |
|--------|------|-------------------|
| producer.properties | ç”Ÿäº§è€…é…ç½® | localhost:9092 |
| consumer.properties | æ¶ˆè´¹è€…é…ç½® | localhost:9092 |
| server.properties | æœåŠ¡å™¨é…ç½® | localhost:9092 |
| client.properties | å®¢æˆ·ç«¯é…ç½® | localhost:9092 |

### TopicçŠ¶æ€
- âœ… **example-metric1** - å·²åˆ›å»ºï¼ˆ3ä¸ªåˆ†åŒºï¼Œå‰¯æœ¬å› å­ä¸º1ï¼‰
- âœ… **test** - å·²å­˜åœ¨

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•Kafkaè¿æ¥
```bash
cd src/kafka-examples
./test-kafka-connection.sh
```

### 2. ç¼–è¯‘é¡¹ç›®
```bash
cd src/kafka-examples
mvn clean package
```

### 3. è¿è¡Œç”Ÿäº§è€…ç¤ºä¾‹
```bash
java -cp target/kafka-examples-8.5.1-351.r22.jar \
  com.huawei.bigdata.kafka.example.Producer
```

### 4. è¿è¡Œæ¶ˆè´¹è€…ç¤ºä¾‹ï¼ˆæ–°å¼€ç»ˆç«¯ï¼‰
```bash
java -cp target/kafka-examples-8.5.1-351.r22.jar \
  com.huawei.bigdata.kafka.example.Consumer
```

---

## ğŸ“ é…ç½®è¯¦æƒ…

### Produceré…ç½® (producer.properties)
```properties
# KafkaæœåŠ¡å™¨åœ°å€
bootstrap.servers=localhost:9092

# å®¢æˆ·ç«¯ID
client.id=DemoProducer

# åºåˆ—åŒ–å™¨
key.serializer=org.apache.kafka.common.serialization.StringSerializer
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# å®‰å…¨åè®®ï¼ˆæ— è®¤è¯ï¼‰
security.protocol=PLAINTEXT

# åº”ç­”çº§åˆ«
acks=1

# é‡è¯•æ¬¡æ•°
retries=3

# æ‰¹é‡å¤§å°
batch.size=16384
```

### Consumeré…ç½® (consumer.properties)
```properties
# KafkaæœåŠ¡å™¨åœ°å€
bootstrap.servers=localhost:9092

# æ¶ˆè´¹è€…ç»„ID
group.id=DemoConsumer

# ååºåˆ—åŒ–å™¨
key.deserializer=org.apache.kafka.common.serialization.StringDeserializer
value.deserializer=org.apache.kafka.common.serialization.StringDeserializer

# å®‰å…¨åè®®ï¼ˆæ— è®¤è¯ï¼‰
security.protocol=PLAINTEXT

# è‡ªåŠ¨æäº¤offset
enable.auto.commit=true
auto.commit.interval.ms=1000

# ä¼šè¯è¶…æ—¶
session.timeout.ms=30000

# ä»å“ªé‡Œå¼€å§‹æ¶ˆè´¹
auto.offset.reset=latest
```

---

## ğŸ”§ å¸¸ç”¨Kafkaå‘½ä»¤

### æŸ¥çœ‹æ‰€æœ‰Topic
```bash
docker exec kafka kafka-topics.sh --list --bootstrap-server localhost:9092
```

### æŸ¥çœ‹Topicè¯¦æƒ…
```bash
docker exec kafka kafka-topics.sh --describe --topic example-metric1 \
  --bootstrap-server localhost:9092
```

### åˆ›å»ºæ–°Topic
```bash
docker exec kafka kafka-topics.sh --create --topic my-topic \
  --bootstrap-server localhost:9092 \
  --partitions 3 --replication-factor 1
```

### åˆ é™¤Topic
```bash
docker exec kafka kafka-topics.sh --delete --topic my-topic \
  --bootstrap-server localhost:9092
```

### ä½¿ç”¨å‘½ä»¤è¡Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯
```bash
docker exec -it kafka kafka-console-producer.sh \
  --topic example-metric1 --bootstrap-server localhost:9092
```

### ä½¿ç”¨å‘½ä»¤è¡Œæ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯
```bash
docker exec -it kafka kafka-console-consumer.sh \
  --topic example-metric1 --bootstrap-server localhost:9092 \
  --from-beginning
```

---

## ğŸ¯ ç¤ºä¾‹ä»£ç è¯´æ˜

### Producer.java
- **åŠŸèƒ½**: å‘Kafkaå‘é€æ¶ˆæ¯
- **Topic**: example-metric1
- **æ¶ˆæ¯æ•°é‡**: 100æ¡
- **å‘é€æ¨¡å¼**: åŒæ­¥/å¼‚æ­¥å¯é€‰
- **æµé‡æ§åˆ¶**: æ¯10æ¡æ¶ˆæ¯æš‚åœ1ç§’

### Consumer.java
- **åŠŸèƒ½**: ä»Kafkaæ¶ˆè´¹æ¶ˆæ¯
- **Topic**: example-metric1
- **æ¶ˆè´¹ç»„**: DemoConsumer
- **æäº¤æ¨¡å¼**: è‡ªåŠ¨æäº¤offset

---

## ğŸ’¡ é‡è¦æç¤º

### 1. è¿è¡Œç¯å¢ƒ
å½“å‰é…ç½®é€‚ç”¨äº**å®¿ä¸»æœºè¿è¡Œåº”ç”¨**çš„åœºæ™¯ã€‚

å¦‚æœä½ çš„åº”ç”¨ä¹Ÿåœ¨Dockerå®¹å™¨ä¸­è¿è¡Œï¼Œéœ€è¦ä¿®æ”¹é…ç½®ï¼š
```properties
# ä¿®æ”¹ä¸ºå®¹å™¨å
bootstrap.servers=kafka:9092
```

### 2. å®‰å…¨æ¨¡å¼
å½“å‰ä½¿ç”¨ `PLAINTEXT` æ¨¡å¼ï¼ˆæ— è®¤è¯ã€æ— åŠ å¯†ï¼‰ï¼Œé€‚åˆå­¦ä¹ å’Œå¼€å‘ã€‚

ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨å®‰å…¨è®¤è¯ï¼š
```properties
security.protocol=SASL_PLAINTEXT
sasl.kerberos.service.name=kafka
```

### 3. æ€§èƒ½è°ƒä¼˜
æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š
- `batch.size`: æ‰¹é‡å‘é€å¤§å°
- `linger.ms`: å»¶è¿Ÿæ—¶é—´
- `buffer.memory`: ç¼“å†²åŒºå¤§å°
- `acks`: åº”ç­”çº§åˆ«

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: è¿æ¥è¶…æ—¶
```
Error: Connection to node -1 could not be established
```
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥Kafkaå®¹å™¨æ˜¯å¦è¿è¡Œ: `docker ps | grep kafka`
2. æµ‹è¯•ç«¯å£è¿æ¥: `nc -zv localhost 9092`
3. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ `bootstrap.servers`

### é—®é¢˜2: Topicä¸å­˜åœ¨
```
Error: Topic 'example-metric1' not found
```
**è§£å†³æ–¹æ¡ˆ**:
```bash
docker exec kafka kafka-topics.sh --create --topic example-metric1 \
  --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1
```

### é—®é¢˜3: ä¸­æ–‡æ³¨é‡Šæ˜¾ç¤ºä¹±ç 
**è¯´æ˜**: é…ç½®æ–‡ä»¶æ˜¯UTF-8ç¼–ç ï¼Œå¦‚æœç»ˆç«¯æ˜¾ç¤ºä¹±ç ï¼Œè¯·ï¼š
1. ä½¿ç”¨æ”¯æŒUTF-8çš„ç¼–è¾‘å™¨æ‰“å¼€ï¼ˆVS Codeã€IntelliJ IDEAç­‰ï¼‰
2. æˆ–è®¾ç½®ç»ˆç«¯ç¼–ç : `export LANG=zh_CN.UTF-8`

---

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Kafkaå®˜æ–¹æ–‡æ¡£](https://kafka.apache.org/documentation/)
- [Kafkaé…ç½®å‚æ•°](https://kafka.apache.org/documentation/#configuration)

### ç¤ºä¾‹ä»£ç ä½ç½®
```
src/kafka-examples/src/main/java/com/huawei/bigdata/kafka/example/
â”œâ”€â”€ Producer.java          # ç”Ÿäº§è€…ç¤ºä¾‹
â”œâ”€â”€ Consumer.java          # æ¶ˆè´¹è€…ç¤ºä¾‹
â”œâ”€â”€ Producer2.java         # ç”Ÿäº§è€…ç¤ºä¾‹2
â”œâ”€â”€ Consumer3.java         # æ¶ˆè´¹è€…ç¤ºä¾‹3
â”œâ”€â”€ KafkaProperties.java   # é…ç½®ç®¡ç†ç±»
â””â”€â”€ SimplePartitioner.java # è‡ªå®šä¹‰åˆ†åŒºå™¨
```

---

## âœ… éªŒè¯æ¸…å•

- [x] Docker Kafkaå®¹å™¨æ­£å¸¸è¿è¡Œ
- [x] ç«¯å£ 9092 å¯ä»¥è¿æ¥
- [x] é…ç½®æ–‡ä»¶å·²åˆ›å»ºï¼ˆ4ä¸ªï¼‰
- [x] bootstrap.servers å·²é…ç½®ä¸º localhost:9092
- [x] Topic example-metric1 å·²åˆ›å»º
- [x] æµ‹è¯•è„šæœ¬å¯ä»¥æ­£å¸¸è¿è¡Œ

---

## ğŸ‰ æ­å–œï¼

ä½ çš„Kafkaå­¦ä¹ ç¯å¢ƒå·²ç»é…ç½®å®Œæˆï¼ç°åœ¨å¯ä»¥ï¼š
1. âœ… è¿è¡Œç¤ºä¾‹ä»£ç å­¦ä¹ KafkaåŸºç¡€
2. âœ… ä¿®æ”¹ä»£ç è¿›è¡Œå®éªŒ
3. âœ… åˆ›å»ºè‡ªå·±çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…

ç¥å­¦ä¹ æ„‰å¿«ï¼ğŸš€

