# Kafka Docker 集群配置完成 ✅

## 📋 配置摘要

### Docker环境信息
- **容器名称**: `kafka`
- **镜像**: `wurstmeister/kafka:2.12-2.5.0`
- **网络**: `hadoop-cluster_hadoop_network`
- **端口映射**: `0.0.0.0:9092->9092/tcp`
- **连接地址**: `localhost:9092`

### 配置文件状态
所有配置文件已创建并配置完成，位于 `src/main/resources/` 目录：

| 文件名 | 用途 | bootstrap.servers |
|--------|------|-------------------|
| producer.properties | 生产者配置 | localhost:9092 |
| consumer.properties | 消费者配置 | localhost:9092 |
| server.properties | 服务器配置 | localhost:9092 |
| client.properties | 客户端配置 | localhost:9092 |

### Topic状态
- ✅ **example-metric1** - 已创建（3个分区，副本因子为1）
- ✅ **test** - 已存在

---

## 🚀 快速开始

### 1. 测试Kafka连接
```bash
cd src/kafka-examples
./test-kafka-connection.sh
```

### 2. 编译项目
```bash
cd src/kafka-examples
mvn clean package
```

### 3. 运行生产者示例
```bash
java -cp target/kafka-examples-8.5.1-351.r22.jar \
  com.huawei.bigdata.kafka.example.Producer
```

### 4. 运行消费者示例（新开终端）
```bash
java -cp target/kafka-examples-8.5.1-351.r22.jar \
  com.huawei.bigdata.kafka.example.Consumer
```

---

## 📝 配置详情

### Producer配置 (producer.properties)
```properties
# Kafka服务器地址
bootstrap.servers=localhost:9092

# 客户端ID
client.id=DemoProducer

# 序列化器
key.serializer=org.apache.kafka.common.serialization.StringSerializer
value.serializer=org.apache.kafka.common.serialization.StringSerializer

# 安全协议（无认证）
security.protocol=PLAINTEXT

# 应答级别
acks=1

# 重试次数
retries=3

# 批量大小
batch.size=16384
```

### Consumer配置 (consumer.properties)
```properties
# Kafka服务器地址
bootstrap.servers=localhost:9092

# 消费者组ID
group.id=DemoConsumer

# 反序列化器
key.deserializer=org.apache.kafka.common.serialization.StringDeserializer
value.deserializer=org.apache.kafka.common.serialization.StringDeserializer

# 安全协议（无认证）
security.protocol=PLAINTEXT

# 自动提交offset
enable.auto.commit=true
auto.commit.interval.ms=1000

# 会话超时
session.timeout.ms=30000

# 从哪里开始消费
auto.offset.reset=latest
```

---

## 🔧 常用Kafka命令

### 查看所有Topic
```bash
docker exec kafka kafka-topics.sh --list --bootstrap-server localhost:9092
```

### 查看Topic详情
```bash
docker exec kafka kafka-topics.sh --describe --topic example-metric1 \
  --bootstrap-server localhost:9092
```

### 创建新Topic
```bash
docker exec kafka kafka-topics.sh --create --topic my-topic \
  --bootstrap-server localhost:9092 \
  --partitions 3 --replication-factor 1
```

### 删除Topic
```bash
docker exec kafka kafka-topics.sh --delete --topic my-topic \
  --bootstrap-server localhost:9092
```

### 使用命令行生产者发送消息
```bash
docker exec -it kafka kafka-console-producer.sh \
  --topic example-metric1 --bootstrap-server localhost:9092
```

### 使用命令行消费者接收消息
```bash
docker exec -it kafka kafka-console-consumer.sh \
  --topic example-metric1 --bootstrap-server localhost:9092 \
  --from-beginning
```

---

## 🎯 示例代码说明

### Producer.java
- **功能**: 向Kafka发送消息
- **Topic**: example-metric1
- **消息数量**: 100条
- **发送模式**: 同步/异步可选
- **流量控制**: 每10条消息暂停1秒

### Consumer.java
- **功能**: 从Kafka消费消息
- **Topic**: example-metric1
- **消费组**: DemoConsumer
- **提交模式**: 自动提交offset

---

## 💡 重要提示

### 1. 运行环境
当前配置适用于**宿主机运行应用**的场景。

如果你的应用也在Docker容器中运行，需要修改配置：
```properties
# 修改为容器名
bootstrap.servers=kafka:9092
```

### 2. 安全模式
当前使用 `PLAINTEXT` 模式（无认证、无加密），适合学习和开发。

生产环境建议启用安全认证：
```properties
security.protocol=SASL_PLAINTEXT
sasl.kerberos.service.name=kafka
```

### 3. 性能调优
根据实际需求调整以下参数：
- `batch.size`: 批量发送大小
- `linger.ms`: 延迟时间
- `buffer.memory`: 缓冲区大小
- `acks`: 应答级别

---

## 🐛 故障排查

### 问题1: 连接超时
```
Error: Connection to node -1 could not be established
```
**解决方案**:
1. 检查Kafka容器是否运行: `docker ps | grep kafka`
2. 测试端口连接: `nc -zv localhost 9092`
3. 检查配置文件中的 `bootstrap.servers`

### 问题2: Topic不存在
```
Error: Topic 'example-metric1' not found
```
**解决方案**:
```bash
docker exec kafka kafka-topics.sh --create --topic example-metric1 \
  --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1
```

### 问题3: 中文注释显示乱码
**说明**: 配置文件是UTF-8编码，如果终端显示乱码，请：
1. 使用支持UTF-8的编辑器打开（VS Code、IntelliJ IDEA等）
2. 或设置终端编码: `export LANG=zh_CN.UTF-8`

---

## 📚 学习资源

### 官方文档
- [Kafka官方文档](https://kafka.apache.org/documentation/)
- [Kafka配置参数](https://kafka.apache.org/documentation/#configuration)

### 示例代码位置
```
src/kafka-examples/src/main/java/com/huawei/bigdata/kafka/example/
├── Producer.java          # 生产者示例
├── Consumer.java          # 消费者示例
├── Producer2.java         # 生产者示例2
├── Consumer3.java         # 消费者示例3
├── KafkaProperties.java   # 配置管理类
└── SimplePartitioner.java # 自定义分区器
```

---

## ✅ 验证清单

- [x] Docker Kafka容器正常运行
- [x] 端口 9092 可以连接
- [x] 配置文件已创建（4个）
- [x] bootstrap.servers 已配置为 localhost:9092
- [x] Topic example-metric1 已创建
- [x] 测试脚本可以正常运行

---

## 🎉 恭喜！

你的Kafka学习环境已经配置完成！现在可以：
1. ✅ 运行示例代码学习Kafka基础
2. ✅ 修改代码进行实验
3. ✅ 创建自己的生产者和消费者

祝学习愉快！🚀

